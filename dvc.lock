schema: '2.0'
stages:
  split_image:
    cmd: python src/workflow/split_image.py
    deps:
    - path: data/gt
      md5: 5fc404cd009d1089b32cd1bea587ea39.dir
      size: 479948
      nfiles: 32
    - path: data/images
      md5: dbdc23d29d9f073c4b5bf78182c2bfed.dir
      size: 509816
      nfiles: 32
    - path: src/workflow/split_image.py
      md5: 544742599af6d945b5f3d8df68f8bb9a
      size: 1440
    params:
      params.yaml:
        preprocessing.patch_height: 128
        preprocessing.patch_width: 128
    outs:
    - path: data/preprocessed/gt
      md5: 09812c30f4c11efb545d16464f4e9fe7.dir
      size: 242072
      nfiles: 425
    - path: data/preprocessed/img
      md5: 0d4c59cfb54921c3b16db2af0da62b7e.dir
      size: 900764
      nfiles: 425
  select_image:
    cmd: python src/workflow/select_image.py
    deps:
    - path: data/preprocessed/gt
      md5: 09812c30f4c11efb545d16464f4e9fe7.dir
      size: 242072
      nfiles: 425
    - path: data/preprocessed/img
      md5: 0d4c59cfb54921c3b16db2af0da62b7e.dir
      size: 900764
      nfiles: 425
    - path: src/workflow/select_image.py
      md5: 03c27abd9bdc2bc65fc264622ddc0cf7
      size: 1322
    params:
      params.yaml:
        preprocessing.min_cloud_ratio: 0.05
        preprocessing.test_ratio: 0.2
        preprocessing.val_ratio: 0.1
    outs:
    - path: data/preprocessed/test.txt
      md5: 6ab3197731099a74c9beb094a896686e
      size: 337
    - path: data/preprocessed/train.txt
      md5: 660a803448e2895cd588dce091d4e6ba
      size: 1196
    - path: data/preprocessed/val.txt
      md5: 7d68f6d29f2a0723979c352a83276e67
      size: 161
  train_model:
    cmd: python src/workflow/train_model.py
    deps:
    - path: data/preprocessed/train.txt
      md5: 660a803448e2895cd588dce091d4e6ba
      size: 1196
    - path: data/preprocessed/val.txt
      md5: 7d68f6d29f2a0723979c352a83276e67
      size: 161
    - path: src/workflow/train_model.py
      md5: ff3c2112dbd35588e68342d3e3b0b158
      size: 2819
    params:
      params.yaml:
        model:
          n_classes: 1
          in_channels: 3
        training:
          batch_size: 16
          n_epochs: 10
          optimizer: Adam
          lr: 0.001
    outs:
    - path: model/model.pth
      md5: d43d5d89ca339a3d22e28d1c15adcf94
      size: 69147905
  eval:
    cmd: python src/workflow/eval.py
    deps:
    - path: data/preprocessed/test.txt
      md5: 6ab3197731099a74c9beb094a896686e
      size: 337
    - path: model/model.pth
      md5: d43d5d89ca339a3d22e28d1c15adcf94
      size: 69147905
    - path: src/workflow/eval.py
      md5: 9fbce601b4b29d0084cc7503b81aad72
      size: 2703
    outs:
    - path: model/performance.json
      md5: a00832e0062a1c0b09f7f2b6ebe45f57
      size: 135
